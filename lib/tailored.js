'use strict';

/* @flow */

class Variable {
  constructor(name = null) {
    this.name = name;
  }
}

class Wildcard {
  constructor() {}
}

class StartsWith {

  constructor(prefix) {
    this.prefix = prefix;
  }
}

class Capture {

  constructor(value) {
    this.value = value;
  }
}

class HeadTail {
  constructor() {}
}

class Type {

  constructor(type, objPattern = {}) {
    this.type = type;
    this.objPattern = objPattern;
  }
}

class Bound {

  constructor(value) {
    this.value = value;
  }
}

function variable(name = null) {
  return new Variable(name);
}

function wildcard() {
  return new Wildcard();
}

function startsWith(prefix) {
  return new StartsWith(prefix);
}

function capture(value) {
  return new Capture(value);
}

function headTail() {
  return new HeadTail();
}

function type(type, objPattern = {}) {
  return new Type(type, objPattern);
}

function bound(value) {
  return new Bound(value);
}

function is_number(value) {
  return typeof value === 'number';
}

function is_string(value) {
  return typeof value === 'string';
}

function is_boolean(value) {
  return typeof value === 'boolean';
}

function is_symbol(value) {
  return typeof value === 'symbol';
}

function is_null(value) {
  return value === null;
}

function is_undefined(value) {
  return typeof value === 'undefined';
}

function is_variable(value) {
  return value instanceof Variable;
}

function is_wildcard(value) {
  return value instanceof Wildcard;
}

function is_headTail(value) {
  return value instanceof HeadTail;
}

function is_capture(value) {
  return value instanceof Capture;
}

function is_type(value) {
  return value instanceof Type;
}

function is_startsWith(value) {
  return value instanceof StartsWith;
}

function is_bound(value) {
  return value instanceof Bound;
}

function is_object(value) {
  return typeof value === 'object';
}

function is_array(value) {
  return Array.isArray(value);
}

function resolveSymbol(pattern) {
  return function (value) {
    return is_symbol(value) && value === pattern;
  };
}

function resolveString(pattern) {
  return function (value) {
    return is_string(value) && value === pattern;
  };
}

function resolveNumber(pattern) {
  return function (value) {
    return is_number(value) && value === pattern;
  };
}

function resolveBoolean(pattern) {
  return function (value) {
    return is_boolean(value) && value === pattern;
  };
}

function resolveNull(pattern) {
  return function (value) {
    return is_null(value);
  };
}

function resolveBound(pattern) {
  return function (value, args) {
    if (typeof value === typeof pattern.value && value === pattern.value) {
      args.push(value);
      return true;
    }

    return false;
  };
}

function resolveWildcard() {
  return function () {
    return true;
  };
}

function resolveVariable() {
  return function (value, args) {
    args.push(value);
    return true;
  };
}

function resolveHeadTail() {
  return function (value, args) {
    if (!is_array(value) || value.length < 2) {
      return false;
    }

    const head = value[0];
    const tail = value.slice(1);

    args.push(head);
    args.push(tail);

    return true;
  };
}

function resolveCapture(pattern) {
  const matches = buildMatch(pattern.value);

  return function (value, args) {
    if (matches(value, args)) {
      args.push(value);
      return true;
    }

    return false;
  };
}

function resolveStartsWith(pattern) {
  const prefix = pattern.prefix;

  return function (value, args) {
    if (is_string(value) && value.startsWith(prefix)) {
      args.push(value.substring(prefix.length));
      return true;
    }

    return false;
  };
}

function resolveType(pattern) {
  return function (value, args) {
    if (value instanceof pattern.type) {
      const matches = buildMatch(pattern.objPattern);
      return matches(value, args) && args.push(value) > 0;
    }

    return false;
  };
}

function resolveArray(pattern) {
  const matches = pattern.map(x => buildMatch(x));

  return function (value, args) {
    if (!is_array(value) || value.length != pattern.length) {
      return false;
    }

    return value.every(function (v, i) {
      return matches[i](value[i], args);
    });
  };
}

function resolveObject(pattern) {
  let matches = {};

  for (let key of Object.keys(pattern)) {
    matches[key] = buildMatch(pattern[key]);
  }

  return function (value, args) {
    if (!is_object(value) || pattern.length > value.length) {
      return false;
    }

    for (let key of Object.keys(pattern)) {
      if (!(key in value) || !matches[key](value[key], args)) {
        return false;
      }
    }

    return true;
  };
}

function resolveNoMatch() {
  return function () {
    return false;
  };
}

function buildMatch(pattern) {

  if (is_variable(pattern)) {
    return resolveVariable(pattern);
  }

  if (is_wildcard(pattern)) {
    return resolveWildcard(pattern);
  }

  if (is_undefined(pattern)) {
    return resolveWildcard(pattern);
  }

  if (is_headTail(pattern)) {
    return resolveHeadTail(pattern);
  }

  if (is_startsWith(pattern)) {
    return resolveStartsWith(pattern);
  }

  if (is_capture(pattern)) {
    return resolveCapture(pattern);
  }

  if (is_bound(pattern)) {
    return resolveBound(pattern);
  }

  if (is_type(pattern)) {
    return resolveType(pattern);
  }

  if (is_array(pattern)) {
    return resolveArray(pattern);
  }

  if (is_number(pattern)) {
    return resolveNumber(pattern);
  }

  if (is_string(pattern)) {
    return resolveString(pattern);
  }

  if (is_boolean(pattern)) {
    return resolveBoolean(pattern);
  }

  if (is_symbol(pattern)) {
    return resolveSymbol(pattern);
  }

  if (is_null(pattern)) {
    return resolveNull(pattern);
  }

  if (is_object(pattern)) {
    return resolveObject(pattern);
  }

  return resolveNoMatch();
}

class MatchError extends Error {
  constructor(arg) {
    super();

    if (typeof arg === 'symbol') {
      this.message = 'No match for: ' + arg.toString();
    } else if (Array.isArray(arg)) {
      let mappedValues = arg.map(x => x.toString());
      this.message = 'No match for: ' + mappedValues;
    } else {
      this.message = 'No match for: ' + arg;
    }

    this.stack = new Error().stack;
    this.name = this.constructor.name;
  }
}

class Clause {
  constructor(pattern, fn, guard = () => true) {
    this.pattern = buildMatch(pattern);
    this.fn = fn;
    this.guard = guard;
  }
}

function clause(pattern, fn, guard = () => true) {
  return new Clause(pattern, fn, guard);
}

function defmatch(...clauses) {
  return function (...args) {
    for (let processedClause of clauses) {
      let result = [];
      if (processedClause.pattern(args, result) && processedClause.guard.apply(this, result)) {
        return processedClause.fn.apply(this, result);
      }
    }

    throw new MatchError(args);
  };
}

function match(pattern, expr, guard = () => true) {
  let result = [];
  let processedPattern = buildMatch(pattern);
  if (processedPattern(expr, result) && guard.apply(this, result)) {
    return result;
  } else {
    throw new MatchError(expr);
  }
}

var index = {
  defmatch, match, MatchError,
  variable, wildcard, startsWith,
  capture, headTail, type, bound, Clause, clause
};

module.exports = index;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi4uL3NyYy90YWlsb3JlZC90eXBlcy5qcyIsIi4uL3NyYy90YWlsb3JlZC9jaGVja3MuanMiLCIuLi9zcmMvdGFpbG9yZWQvcmVzb2x2ZXJzLmpzIiwiLi4vc3JjL3RhaWxvcmVkL21hdGNoLmpzIiwiLi4vc3JjL3RhaWxvcmVkL2RlZm1hdGNoLmpzIiwiLi4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIEBmbG93ICovXG5cbmNsYXNzIFZhcmlhYmxlIHtcbiAgY29uc3RydWN0b3IobmFtZSA9IG51bGwpIHtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICB9XG59XG5cbmNsYXNzIFdpbGRjYXJkIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gIH1cbn1cblxuY2xhc3MgU3RhcnRzV2l0aCB7XG5cbiAgY29uc3RydWN0b3IocHJlZml4KSB7XG4gICAgdGhpcy5wcmVmaXggPSBwcmVmaXg7XG4gIH1cbn1cblxuY2xhc3MgQ2FwdHVyZSB7XG5cbiAgY29uc3RydWN0b3IodmFsdWUpIHtcbiAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gIH1cbn1cblxuY2xhc3MgSGVhZFRhaWwge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgfVxufVxuXG5jbGFzcyBUeXBlIHtcblxuICBjb25zdHJ1Y3Rvcih0eXBlLCBvYmpQYXR0ZXJuID0ge30pIHtcbiAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgIHRoaXMub2JqUGF0dGVybiA9IG9ialBhdHRlcm47XG4gIH1cbn1cblxuY2xhc3MgQm91bmQge1xuXG4gIGNvbnN0cnVjdG9yKHZhbHVlKSB7XG4gICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICB9XG59XG5cbmZ1bmN0aW9uIHZhcmlhYmxlKG5hbWUgPSBudWxsKSB7XG4gIHJldHVybiBuZXcgVmFyaWFibGUobmFtZSk7XG59XG5cbmZ1bmN0aW9uIHdpbGRjYXJkKCkge1xuICByZXR1cm4gbmV3IFdpbGRjYXJkKCk7XG59XG5cbmZ1bmN0aW9uIHN0YXJ0c1dpdGgocHJlZml4KSB7XG4gIHJldHVybiBuZXcgU3RhcnRzV2l0aChwcmVmaXgpO1xufVxuXG5mdW5jdGlvbiBjYXB0dXJlKHZhbHVlKSB7XG4gIHJldHVybiBuZXcgQ2FwdHVyZSh2YWx1ZSk7XG59XG5cbmZ1bmN0aW9uIGhlYWRUYWlsKCkge1xuICByZXR1cm4gbmV3IEhlYWRUYWlsKCk7XG59XG5cbmZ1bmN0aW9uIHR5cGUodHlwZSwgb2JqUGF0dGVybiA9IHt9KSB7XG4gIHJldHVybiBuZXcgVHlwZSh0eXBlLCBvYmpQYXR0ZXJuKTtcbn1cblxuZnVuY3Rpb24gYm91bmQodmFsdWUpIHtcbiAgcmV0dXJuIG5ldyBCb3VuZCh2YWx1ZSk7XG59XG5cbmV4cG9ydCB7XG4gIFZhcmlhYmxlLFxuICBXaWxkY2FyZCxcbiAgU3RhcnRzV2l0aCxcbiAgQ2FwdHVyZSxcbiAgSGVhZFRhaWwsXG4gIFR5cGUsXG4gIEJvdW5kLFxuICB2YXJpYWJsZSxcbiAgd2lsZGNhcmQsXG4gIHN0YXJ0c1dpdGgsXG4gIGNhcHR1cmUsXG4gIGhlYWRUYWlsLFxuICB0eXBlLFxuICBib3VuZFxufTtcbiIsIi8qIEBmbG93ICovXG5cbmltcG9ydCB7IFZhcmlhYmxlLCBXaWxkY2FyZCwgSGVhZFRhaWwsIENhcHR1cmUsIFR5cGUsIFN0YXJ0c1dpdGgsIEJvdW5kIH0gZnJvbSBcIi4vdHlwZXNcIjtcblxuZnVuY3Rpb24gaXNfbnVtYmVyKHZhbHVlKSB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInO1xufVxuXG5mdW5jdGlvbiBpc19zdHJpbmcodmFsdWUpe1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJztcbn1cblxuZnVuY3Rpb24gaXNfYm9vbGVhbih2YWx1ZSkge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbic7XG59XG5cbmZ1bmN0aW9uIGlzX3N5bWJvbCh2YWx1ZSkge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3ltYm9sJztcbn1cblxuZnVuY3Rpb24gaXNfbnVsbCh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgPT09IG51bGw7XG59XG5cbmZ1bmN0aW9uIGlzX3VuZGVmaW5lZCh2YWx1ZSkge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAndW5kZWZpbmVkJztcbn1cblxuZnVuY3Rpb24gaXNfZnVuY3Rpb24odmFsdWUpIHtcbiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT0gJ1tvYmplY3QgRnVuY3Rpb25dJztcbn1cblxuZnVuY3Rpb24gaXNfdmFyaWFibGUodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgVmFyaWFibGU7XG59XG5cbmZ1bmN0aW9uIGlzX3dpbGRjYXJkKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFdpbGRjYXJkO1xufVxuXG5mdW5jdGlvbiBpc19oZWFkVGFpbCh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBIZWFkVGFpbDtcbn1cblxuZnVuY3Rpb24gaXNfY2FwdHVyZSh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBDYXB0dXJlO1xufVxuXG5mdW5jdGlvbiBpc190eXBlKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFR5cGU7XG59XG5cbmZ1bmN0aW9uIGlzX3N0YXJ0c1dpdGgodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgU3RhcnRzV2l0aDtcbn1cblxuZnVuY3Rpb24gaXNfYm91bmQodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgQm91bmQ7XG59XG5cbmZ1bmN0aW9uIGlzX29iamVjdCh2YWx1ZSkge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jztcbn1cblxuZnVuY3Rpb24gaXNfYXJyYXkodmFsdWUpIHtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpO1xufVxuXG5leHBvcnQge1xuICBpc19udW1iZXIsXG4gIGlzX3N0cmluZyxcbiAgaXNfYm9vbGVhbixcbiAgaXNfc3ltYm9sLFxuICBpc19udWxsLFxuICBpc191bmRlZmluZWQsXG4gIGlzX2Z1bmN0aW9uLFxuICBpc192YXJpYWJsZSxcbiAgaXNfd2lsZGNhcmQsXG4gIGlzX2hlYWRUYWlsLFxuICBpc19jYXB0dXJlLFxuICBpc190eXBlLFxuICBpc19zdGFydHNXaXRoLFxuICBpc19ib3VuZCxcbiAgaXNfb2JqZWN0LFxuICBpc19hcnJheVxufTtcbiIsIi8qIEBmbG93ICovXG5cbmltcG9ydCAqIGFzIENoZWNrcyBmcm9tIFwiLi9jaGVja3NcIjtcbmltcG9ydCAqIGFzIFR5cGVzIGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgeyBidWlsZE1hdGNoIH0gZnJvbSBcIi4vbWF0Y2hcIjtcblxuZnVuY3Rpb24gcmVzb2x2ZVN5bWJvbChwYXR0ZXJuKXtcbiAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKXtcbiAgICByZXR1cm4gQ2hlY2tzLmlzX3N5bWJvbCh2YWx1ZSkgJiYgdmFsdWUgPT09IHBhdHRlcm47XG4gIH07XG59XG5cbmZ1bmN0aW9uIHJlc29sdmVTdHJpbmcocGF0dGVybil7XG4gIHJldHVybiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgcmV0dXJuIENoZWNrcy5pc19zdHJpbmcodmFsdWUpICYmIHZhbHVlID09PSBwYXR0ZXJuO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZXNvbHZlTnVtYmVyKHBhdHRlcm4pe1xuICByZXR1cm4gZnVuY3Rpb24odmFsdWUpe1xuICAgIHJldHVybiBDaGVja3MuaXNfbnVtYmVyKHZhbHVlKSAmJiB2YWx1ZSA9PT0gcGF0dGVybjtcbiAgfTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZUJvb2xlYW4ocGF0dGVybil7XG4gIHJldHVybiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgcmV0dXJuIENoZWNrcy5pc19ib29sZWFuKHZhbHVlKSAmJiB2YWx1ZSA9PT0gcGF0dGVybjtcbiAgfTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZUZ1bmN0aW9uKHBhdHRlcm4pe1xuICByZXR1cm4gZnVuY3Rpb24odmFsdWUpe1xuICAgIHJldHVybiBDaGVja3MuaXNfZnVuY3Rpb24odmFsdWUpICYmIHZhbHVlID09PSBwYXR0ZXJuO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZXNvbHZlTnVsbChwYXR0ZXJuKXtcbiAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKXtcbiAgICByZXR1cm4gQ2hlY2tzLmlzX251bGwodmFsdWUpO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZXNvbHZlQm91bmQocGF0dGVybil7XG4gIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgYXJncyl7XG4gICAgaWYodHlwZW9mIHZhbHVlID09PSB0eXBlb2YgcGF0dGVybi52YWx1ZSAmJiB2YWx1ZSA9PT0gcGF0dGVybi52YWx1ZSl7XG4gICAgICBhcmdzLnB1c2godmFsdWUpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZXNvbHZlV2lsZGNhcmQoKXtcbiAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZXNvbHZlVmFyaWFibGUoKXtcbiAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlLCBhcmdzKXtcbiAgICBhcmdzLnB1c2godmFsdWUpO1xuICAgIHJldHVybiB0cnVlO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZXNvbHZlSGVhZFRhaWwoKSB7XG4gIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgYXJncykge1xuICAgIGlmKCFDaGVja3MuaXNfYXJyYXkodmFsdWUpIHx8IHZhbHVlLmxlbmd0aCA8IDIpe1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGhlYWQgPSB2YWx1ZVswXTtcbiAgICBjb25zdCB0YWlsID0gdmFsdWUuc2xpY2UoMSk7XG5cbiAgICBhcmdzLnB1c2goaGVhZCk7XG4gICAgYXJncy5wdXNoKHRhaWwpO1xuXG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG59XG5cbmZ1bmN0aW9uIHJlc29sdmVDYXB0dXJlKHBhdHRlcm4pIHtcbiAgY29uc3QgbWF0Y2hlcyA9IGJ1aWxkTWF0Y2gocGF0dGVybi52YWx1ZSk7XG5cbiAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlLCBhcmdzKSB7XG4gICAgaWYobWF0Y2hlcyh2YWx1ZSwgYXJncykpe1xuICAgICAgYXJncy5wdXNoKHZhbHVlKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZVN0YXJ0c1dpdGgocGF0dGVybikge1xuICBjb25zdCBwcmVmaXggPSBwYXR0ZXJuLnByZWZpeDtcblxuICByZXR1cm4gZnVuY3Rpb24odmFsdWUsIGFyZ3MpIHtcbiAgICBpZihDaGVja3MuaXNfc3RyaW5nKHZhbHVlKSAmJiB2YWx1ZS5zdGFydHNXaXRoKHByZWZpeCkpe1xuICAgICAgYXJncy5wdXNoKHZhbHVlLnN1YnN0cmluZyhwcmVmaXgubGVuZ3RoKSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG59XG5cbmZ1bmN0aW9uIHJlc29sdmVUeXBlKHBhdHRlcm4pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlLCBhcmdzKSB7XG4gICAgaWYodmFsdWUgaW5zdGFuY2VvZiBwYXR0ZXJuLnR5cGUpe1xuICAgICAgY29uc3QgbWF0Y2hlcyA9IGJ1aWxkTWF0Y2gocGF0dGVybi5vYmpQYXR0ZXJuKTtcbiAgICAgIHJldHVybiBtYXRjaGVzKHZhbHVlLCBhcmdzKSAmJiBhcmdzLnB1c2godmFsdWUpID4gMDtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG59XG5cbmZ1bmN0aW9uIHJlc29sdmVBcnJheShwYXR0ZXJuKSB7XG4gIGNvbnN0IG1hdGNoZXMgPSBwYXR0ZXJuLm1hcCh4ID0+IGJ1aWxkTWF0Y2goeCkpO1xuXG4gIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgYXJncykge1xuICAgIGlmKCFDaGVja3MuaXNfYXJyYXkodmFsdWUpIHx8IHZhbHVlLmxlbmd0aCAhPSBwYXR0ZXJuLmxlbmd0aCl7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlLmV2ZXJ5KGZ1bmN0aW9uKHYsIGkpIHtcbiAgICAgIHJldHVybiBtYXRjaGVzW2ldKHZhbHVlW2ldLCBhcmdzKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZU9iamVjdChwYXR0ZXJuKSB7XG4gIGxldCBtYXRjaGVzID0ge307XG5cbiAgZm9yKGxldCBrZXkgb2YgT2JqZWN0LmtleXMocGF0dGVybikpe1xuICAgIG1hdGNoZXNba2V5XSA9IGJ1aWxkTWF0Y2gocGF0dGVybltrZXldKTtcbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbih2YWx1ZSwgYXJncykge1xuICAgIGlmKCFDaGVja3MuaXNfb2JqZWN0KHZhbHVlKSB8fCBwYXR0ZXJuLmxlbmd0aCA+IHZhbHVlLmxlbmd0aCl7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgZm9yKGxldCBrZXkgb2YgT2JqZWN0LmtleXMocGF0dGVybikpe1xuICAgICAgaWYoIShrZXkgaW4gdmFsdWUpIHx8ICFtYXRjaGVzW2tleV0odmFsdWVba2V5XSwgYXJncykgKXtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9O1xufVxuXG5mdW5jdGlvbiByZXNvbHZlTm9NYXRjaCgpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbn1cblxuZXhwb3J0IHtcbiAgcmVzb2x2ZUJvdW5kLFxuICByZXNvbHZlV2lsZGNhcmQsXG4gIHJlc29sdmVWYXJpYWJsZSxcbiAgcmVzb2x2ZUhlYWRUYWlsLFxuICByZXNvbHZlQ2FwdHVyZSxcbiAgcmVzb2x2ZVN0YXJ0c1dpdGgsXG4gIHJlc29sdmVUeXBlLFxuICByZXNvbHZlQXJyYXksXG4gIHJlc29sdmVPYmplY3QsXG4gIHJlc29sdmVOb01hdGNoLFxuICByZXNvbHZlU3ltYm9sLFxuICByZXNvbHZlU3RyaW5nLFxuICByZXNvbHZlTnVtYmVyLFxuICByZXNvbHZlQm9vbGVhbixcbiAgcmVzb2x2ZUZ1bmN0aW9uLFxuICByZXNvbHZlTnVsbFxufTtcbiIsIi8qIEBmbG93ICovXG5pbXBvcnQgKiBhcyBDaGVja3MgZnJvbSBcIi4vY2hlY2tzXCI7XG5pbXBvcnQgKiBhcyBSZXNvbHZlcnMgZnJvbSBcIi4vcmVzb2x2ZXJzXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBidWlsZE1hdGNoKHBhdHRlcm4pIHtcblxuICBpZihDaGVja3MuaXNfdmFyaWFibGUocGF0dGVybikpe1xuICAgIHJldHVybiBSZXNvbHZlcnMucmVzb2x2ZVZhcmlhYmxlKHBhdHRlcm4pO1xuICB9XG5cbiAgaWYoQ2hlY2tzLmlzX3dpbGRjYXJkKHBhdHRlcm4pKXtcbiAgICByZXR1cm4gUmVzb2x2ZXJzLnJlc29sdmVXaWxkY2FyZChwYXR0ZXJuKTtcbiAgfVxuXG4gIGlmKENoZWNrcy5pc191bmRlZmluZWQocGF0dGVybikpe1xuICAgIHJldHVybiBSZXNvbHZlcnMucmVzb2x2ZVdpbGRjYXJkKHBhdHRlcm4pO1xuICB9XG5cbiAgaWYoQ2hlY2tzLmlzX2hlYWRUYWlsKHBhdHRlcm4pKXtcbiAgICByZXR1cm4gUmVzb2x2ZXJzLnJlc29sdmVIZWFkVGFpbChwYXR0ZXJuKTtcbiAgfVxuXG4gIGlmKENoZWNrcy5pc19zdGFydHNXaXRoKHBhdHRlcm4pKXtcbiAgICByZXR1cm4gUmVzb2x2ZXJzLnJlc29sdmVTdGFydHNXaXRoKHBhdHRlcm4pO1xuICB9XG5cbiAgaWYoQ2hlY2tzLmlzX2NhcHR1cmUocGF0dGVybikpe1xuICAgIHJldHVybiBSZXNvbHZlcnMucmVzb2x2ZUNhcHR1cmUocGF0dGVybik7XG4gIH1cblxuICBpZihDaGVja3MuaXNfYm91bmQocGF0dGVybikpe1xuICAgIHJldHVybiBSZXNvbHZlcnMucmVzb2x2ZUJvdW5kKHBhdHRlcm4pO1xuICB9XG5cbiAgaWYoQ2hlY2tzLmlzX3R5cGUocGF0dGVybikpe1xuICAgIHJldHVybiBSZXNvbHZlcnMucmVzb2x2ZVR5cGUocGF0dGVybik7XG4gIH1cblxuICBpZihDaGVja3MuaXNfYXJyYXkocGF0dGVybikpe1xuICAgIHJldHVybiBSZXNvbHZlcnMucmVzb2x2ZUFycmF5KHBhdHRlcm4pO1xuICB9XG5cbiAgaWYoQ2hlY2tzLmlzX251bWJlcihwYXR0ZXJuKSl7XG4gICAgcmV0dXJuIFJlc29sdmVycy5yZXNvbHZlTnVtYmVyKHBhdHRlcm4pO1xuICB9XG5cbiAgaWYoQ2hlY2tzLmlzX3N0cmluZyhwYXR0ZXJuKSl7XG4gICAgcmV0dXJuIFJlc29sdmVycy5yZXNvbHZlU3RyaW5nKHBhdHRlcm4pO1xuICB9XG5cbiAgaWYoQ2hlY2tzLmlzX2Jvb2xlYW4ocGF0dGVybikpe1xuICAgIHJldHVybiBSZXNvbHZlcnMucmVzb2x2ZUJvb2xlYW4ocGF0dGVybik7XG4gIH1cblxuICBpZihDaGVja3MuaXNfc3ltYm9sKHBhdHRlcm4pKXtcbiAgICByZXR1cm4gUmVzb2x2ZXJzLnJlc29sdmVTeW1ib2wocGF0dGVybik7XG4gIH1cblxuICBpZihDaGVja3MuaXNfbnVsbChwYXR0ZXJuKSl7XG4gICAgcmV0dXJuIFJlc29sdmVycy5yZXNvbHZlTnVsbChwYXR0ZXJuKTtcbiAgfVxuXG4gIGlmKENoZWNrcy5pc19vYmplY3QocGF0dGVybikpe1xuICAgIHJldHVybiBSZXNvbHZlcnMucmVzb2x2ZU9iamVjdChwYXR0ZXJuKTtcbiAgfVxuXG4gIHJldHVybiBSZXNvbHZlcnMucmVzb2x2ZU5vTWF0Y2goKTtcbn1cbiIsIi8qIEBmbG93ICovXG5cbmltcG9ydCB7IGJ1aWxkTWF0Y2ggfSBmcm9tIFwiLi9tYXRjaFwiO1xuXG5leHBvcnQgY2xhc3MgTWF0Y2hFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoYXJnKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIGlmKHR5cGVvZiBhcmcgPT09ICdzeW1ib2wnKXtcbiAgICAgIHRoaXMubWVzc2FnZSA9ICdObyBtYXRjaCBmb3I6ICcgKyBhcmcudG9TdHJpbmcoKTtcbiAgICB9IGVsc2UgaWYoQXJyYXkuaXNBcnJheShhcmcpKXtcbiAgICAgIGxldCBtYXBwZWRWYWx1ZXMgPSBhcmcubWFwKCh4KSA9PiB4LnRvU3RyaW5nKCkpO1xuICAgICAgdGhpcy5tZXNzYWdlID0gJ05vIG1hdGNoIGZvcjogJyArIG1hcHBlZFZhbHVlcztcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMubWVzc2FnZSA9ICdObyBtYXRjaCBmb3I6ICcgKyBhcmc7XG4gICAgfVxuXG4gICAgdGhpcy5zdGFjayA9IChuZXcgRXJyb3IoKSkuc3RhY2s7XG4gICAgdGhpcy5uYW1lID0gdGhpcy5jb25zdHJ1Y3Rvci5uYW1lO1xuICB9XG59XG5cblxuZXhwb3J0IGNsYXNzIENsYXVzZSB7XG4gIGNvbnN0cnVjdG9yKHBhdHRlcm4sIGZuLCBndWFyZCA9ICgpID0+IHRydWUpe1xuICAgIHRoaXMucGF0dGVybiA9IGJ1aWxkTWF0Y2gocGF0dGVybik7XG4gICAgdGhpcy5mbiA9IGZuO1xuICAgIHRoaXMuZ3VhcmQgPSBndWFyZDtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xhdXNlKHBhdHRlcm4sIGZuLCBndWFyZCA9ICgpID0+IHRydWUpIHtcbiAgcmV0dXJuIG5ldyBDbGF1c2UocGF0dGVybiwgZm4sIGd1YXJkKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlZm1hdGNoKC4uLmNsYXVzZXMpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKC4uLmFyZ3MpIHtcbiAgICBmb3IgKGxldCBwcm9jZXNzZWRDbGF1c2Ugb2YgY2xhdXNlcykge1xuICAgICAgbGV0IHJlc3VsdCA9IFtdO1xuICAgICAgaWYgKHByb2Nlc3NlZENsYXVzZS5wYXR0ZXJuKGFyZ3MsIHJlc3VsdCkgJiYgcHJvY2Vzc2VkQ2xhdXNlLmd1YXJkLmFwcGx5KHRoaXMsIHJlc3VsdCkpIHtcbiAgICAgICAgcmV0dXJuIHByb2Nlc3NlZENsYXVzZS5mbi5hcHBseSh0aGlzLCByZXN1bHQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRocm93IG5ldyBNYXRjaEVycm9yKGFyZ3MpO1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWF0Y2gocGF0dGVybiwgZXhwciwgZ3VhcmQgPSAoKSA9PiB0cnVlKSB7XG4gIGxldCByZXN1bHQgPSBbXTtcbiAgbGV0IHByb2Nlc3NlZFBhdHRlcm4gPSBidWlsZE1hdGNoKHBhdHRlcm4pO1xuICBpZiAocHJvY2Vzc2VkUGF0dGVybihleHByLCByZXN1bHQpICYmIGd1YXJkLmFwcGx5KHRoaXMsIHJlc3VsdCkpe1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1lbHNle1xuICAgIHRocm93IG5ldyBNYXRjaEVycm9yKGV4cHIpO1xuICB9XG59XG4iLCJpbXBvcnQgeyBkZWZtYXRjaCwgbWF0Y2gsIE1hdGNoRXJyb3IsIENsYXVzZSwgY2xhdXNlIH0gZnJvbSBcIi4vdGFpbG9yZWQvZGVmbWF0Y2hcIjtcbmltcG9ydCB7IHZhcmlhYmxlLCB3aWxkY2FyZCwgc3RhcnRzV2l0aCwgY2FwdHVyZSwgaGVhZFRhaWwsIHR5cGUsIGJvdW5kIH0gZnJvbSBcIi4vdGFpbG9yZWQvdHlwZXNcIjtcblxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGRlZm1hdGNoLCBtYXRjaCwgTWF0Y2hFcnJvcixcbiAgdmFyaWFibGUsIHdpbGRjYXJkLCBzdGFydHNXaXRoLFxuICBjYXB0dXJlLCBoZWFkVGFpbCwgdHlwZSwgYm91bmQsIENsYXVzZSwgY2xhdXNlXG59O1xuIl0sIm5hbWVzIjpbIkNoZWNrcy5pc19zeW1ib2wiLCJDaGVja3MuaXNfc3RyaW5nIiwiQ2hlY2tzLmlzX251bWJlciIsIkNoZWNrcy5pc19ib29sZWFuIiwiQ2hlY2tzLmlzX251bGwiLCJDaGVja3MuaXNfYXJyYXkiLCJDaGVja3MuaXNfb2JqZWN0IiwiQ2hlY2tzLmlzX3ZhcmlhYmxlIiwiUmVzb2x2ZXJzLnJlc29sdmVWYXJpYWJsZSIsIkNoZWNrcy5pc193aWxkY2FyZCIsIlJlc29sdmVycy5yZXNvbHZlV2lsZGNhcmQiLCJDaGVja3MuaXNfdW5kZWZpbmVkIiwiQ2hlY2tzLmlzX2hlYWRUYWlsIiwiUmVzb2x2ZXJzLnJlc29sdmVIZWFkVGFpbCIsIkNoZWNrcy5pc19zdGFydHNXaXRoIiwiUmVzb2x2ZXJzLnJlc29sdmVTdGFydHNXaXRoIiwiQ2hlY2tzLmlzX2NhcHR1cmUiLCJSZXNvbHZlcnMucmVzb2x2ZUNhcHR1cmUiLCJDaGVja3MuaXNfYm91bmQiLCJSZXNvbHZlcnMucmVzb2x2ZUJvdW5kIiwiQ2hlY2tzLmlzX3R5cGUiLCJSZXNvbHZlcnMucmVzb2x2ZVR5cGUiLCJSZXNvbHZlcnMucmVzb2x2ZUFycmF5IiwiUmVzb2x2ZXJzLnJlc29sdmVOdW1iZXIiLCJSZXNvbHZlcnMucmVzb2x2ZVN0cmluZyIsIlJlc29sdmVycy5yZXNvbHZlQm9vbGVhbiIsIlJlc29sdmVycy5yZXNvbHZlU3ltYm9sIiwiUmVzb2x2ZXJzLnJlc29sdmVOdWxsIiwiUmVzb2x2ZXJzLnJlc29sdmVPYmplY3QiLCJSZXNvbHZlcnMucmVzb2x2ZU5vTWF0Y2giXSwibWFwcGluZ3MiOiI7Ozs7QUFFQSxNQUFNLFFBQU4sQ0FBZTtjQUNELE9BQU8sSUFBbkIsRUFBeUI7U0FDbEIsSUFBTCxHQUFZLElBQVo7Ozs7QUFJSixNQUFNLFFBQU4sQ0FBZTtnQkFDQzs7O0FBSWhCLE1BQU0sVUFBTixDQUFpQjs7Y0FFSCxNQUFaLEVBQW9CO1NBQ2IsTUFBTCxHQUFjLE1BQWQ7Ozs7QUFJSixNQUFNLE9BQU4sQ0FBYzs7Y0FFQSxLQUFaLEVBQW1CO1NBQ1osS0FBTCxHQUFhLEtBQWI7Ozs7QUFJSixNQUFNLFFBQU4sQ0FBZTtnQkFDQzs7O0FBSWhCLE1BQU0sSUFBTixDQUFXOztjQUVHLElBQVosRUFBa0IsYUFBYSxFQUEvQixFQUFtQztTQUM1QixJQUFMLEdBQVksSUFBWjtTQUNLLFVBQUws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